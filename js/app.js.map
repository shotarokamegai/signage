{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/main.coffee","app.js","src/Ad.coffee","src/Controller.coffee","src/Signage.coffee","src/Video.coffee"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"Ad","Signage","Video","ads","data","movies","order","start","./Ad","./Signage","./Video",2,"module","Controller","bind","fn","me","apply","arguments","extend","child","parent","ctor","this","constructor","key","hasProp","prototype","__super__","hasOwnProperty","superClass","selector","sources","stop","$el","$","tid","max","cur","timeout","next","ready","self","Promise","_this","resolve","img","src","Image","on","html","setTimeout","clearTimeout","trigger","./Controller",3,"addClass","close","removeClass","EventEmitter",4,"scenes","len","ref","scene","error","onEnd","then","getNextScene","change","nextScene",5,"reset","empty","nextVideo","reject","video","console","log","appendTo","play","find","get","currentTime"],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\ndo ->\n\n  Video = require \"./Video\"\n  Ad = require \"./Ad\"\n  Signage = require \"./Signage\"\n\n  movies = [\n    \"http://pdl.vimeocdn.com/02014/089/230012081.mp4?token2=1425872474_7564e65b8552e17db3a943c26d5b8d39\"\n    \"https://avvimeo-a.akamaihd.net/40223/653/137113021.mp4?token2=1425872704_827890d526908dc4b866926a3e510810\"\n  ]\n\n  ads = [\n    \"http://c4.staticflickr.com/8/7286/16129131004_20f558be87_k.jpg\"\n    \"http://c4.staticflickr.com/8/7605/16747512421_27180963a6_h.jpg\"\n  ]\n\n  data = [\n    new Video(\"#video\", movies)\n    new Ad(\"#ad\", ads)\n  ]\n\n  # player dydnamic control\n  order = [1, 0]\n\n  s = new Signage(data, order)\n  s.start()\n\n\n",null,"Controller = require \"./Controller\"\n\nclass Ad extends Controller\n\n  @timeout: 15000\n\n  constructor: (selector, @sources) ->\n    @$el = $(\"#{ selector }\")\n    @tid = \"\"\n    @sources\n    @max = @sources.length\n    @cur = -1\n\n  next: ->\n    if @cur + 1 < @max\n      @cur++\n    else\n      @cur = 0\n    @sources[@cur]\n\n  ready: ->\n    self = @\n    new Promise (resolve, reject) =>\n      src = @next()\n      img = new Image()\n      $(img).on 'load', ->\n        self.$el.html img\n        resolve()\n      img.src = src\n\n  start: ->\n    super()\n    @tid = setTimeout @stop, Ad.timeout\n\n  stop: =>\n    @tid = clearTimeout(@tid)\n    @tid = null\n    @trigger \"ended\"\n\nmodule.exports = Ad\n","\nclass Controller extends EventEmitter\n\n  start: ->\n    @$el.addClass \"active\"\n\n  close: ->\n    @$el.removeClass \"active\"\n\nmodule.exports = Controller","class Signage\n\n  constructor: (scenes = [], order = []) ->\n    @cur = 0\n    @scenes = scenes\n    @order = order\n    @max = @order.length\n    @scene = @scenes[@order[@cur]]\n\n    for scene in @scenes\n      #observer\n      scene.on \"ended\", @onEnd\n\n  onEnd: =>\n    @next()\n\n  start: ->\n    @scene.ready()\n    .then((rs) =>\n      @scene.start()\n    ).catch(@error)\n\n\n  error: =>\n    @next()\n\n  getNextScene: ->\n    if @cur + 1 < @max\n      @cur++\n    else\n      @cur = 0\n    @scenes[@order[@cur]]\n\n  change: (next)->\n    @scene.close()\n    @scene = next\n    @scene.start()\n\n  next: ->\n    nextScene = @getNextScene()\n    if nextScene is @scene\n      @scene.start()\n    else\n      nextScene.ready()\n      .then((rs) =>\n        @change(nextScene)\n      )\n      .catch(@error)\n\nmodule.exports = Signage\n","Controller = require \"./Controller\"\n\nclass Video extends Controller\n\n  constructor: (selector, src) ->\n    @$el = $(\"#{ selector }\")\n    @src = src\n    @max = src.length\n    @cur = -1\n\n  reset: ->\n    @$el.empty()\n\n  nextVideo: ->\n    if @cur + 1 < @max\n      @cur++\n    else\n      @cur = 0\n    @src[@cur]\n\n  ready: ->\n    @reset()\n    new Promise (resolve, reject) =>\n      self = @\n      video = @nextVideo()\n      console.log \"set video #{ video }\"\n\n      src = \"\"\"<video src=\"#{ video }\"></video>\"\"\"\n      $(src).appendTo(@$el)\n      .on \"error\", ->\n        return reject(10)\n      .on \"stalled\", ->\n        self.stop()\n        return reject(11)\n      .on \"abort\", ->\n        return reject(9)\n      .on \"loadeddata\", ->\n        return resolve(true)\n      .on \"ended\", ->\n        self.stop()\n\n  play: ->\n    @$el.find(\"video\").get(0).currentTime = 0\n    @$el.find(\"video\").get(0).play()\n\n  start: ->\n    super()\n    @play()\n\n  stop: =>\n    @tid = clearTimeout(@tid)\n    @tid = null\n    @.trigger \"ended\"\n\nmodule.exports = Video\n"],"sourceRoot":"/source/"}